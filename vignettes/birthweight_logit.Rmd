---
title: "Birthweight data example"
author:
- name: Kevin Y.X. Wang
  affiliation: School of Mathematics and Statistics, The University of Sydney, Australia
- name: Garth Tarr
  affiliation: School of Mathematics and Statistics, The University of Sydney, Australia
- name: Jean Y.H. Yang
  affiliation: School of Mathematics and Statistics, The University of Sydney, Australia
- name: Samuel Mueller
  affiliation: School of Mathematics and Statistics, The University of Sydney, Australia
output: 
  rmarkdown::html_vignette
vignette: |
  %\VignetteIndexEntry{Birthweight}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction 

In this document, we will perform APES on the `birthweight` data from the `MASS` package. 

There are 189 observations and 8 variables. 
The response variable is a binary variable indicating if an infant is in the low-weight group. 


# Setting up the data

```{r}
library(APES)
library(MASS)
library(tidyverse)

theme_set(
  theme_classic(14) +
    theme(legend.position = "bottom"))
```

## Loading data
```{r}
data("birthwt", package = "MASS")

bwt <- with(birthwt, {
  race <- factor(race, labels = c("white", "black", "other"))
  ptd <- factor(ptl > 0)
  ftv <- factor(ftv)
  levels(ftv)[-(1:2)] <- "2+"
  data.frame(low = factor(low),
             age, lwt, race,
             smoke = (smoke > 0),
             ptd, ht = (ht > 0),
             ui = (ui > 0), ftv)
})
```


# Single run of APES on diabetes data

Due to the small size of this data, we will use the `leaps` estimator.

Since there are some factor variables, we will need to manually create the model matrix/design matrix.

## Using the leaps estimator

```{r}
full_model <- glm(low ~ ., family = binomial, data = bwt)
round(summary(full_model)$coef, 2)

bwt = dplyr::mutate_if(bwt, is.factor, as.character)
x = model.matrix(~0 + . - low, data = bwt)[,-3]
dim(x)
y = as.integer(as.character(bwt$low))
length(y)
```



```{r}
apes_result = apes(model = full_model)
```



# Bootstrapping 

In most practical cases, a single run of any variable selection procedure will not produce stable results. In order to explore stability of variable selection in this case, statistical literatures have examined the stability of variable selection using the bootstrap sampling procedure on the 189 observations. The motivation of APES is to make exhaustive selection to be fast and thus ideally suited for such a procedure

```{r, results = 'hide'}
boot_result = APES::apes(full_model, n_boot = 100)
```


# Variable selection plot

```{r}
plot(boot_result, type = "vip")
```

## Tile plot 

```{r}
plot(boot_result, type = "vip_tile")
```

## Model averaged coefficient plot 
```{r}
plot(boot_result, type = "ma")
```

## Information criterion pathway plot
```{r}
plot(boot_result, type = "path", order = "BIC")
```

# Session Info
```{r}
sessionInfo()
```

