<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>APES: birth weight data example • APES</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="APES: birth weight data example">
<meta property="og:description" content="APES">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">APES</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/APES.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/birthweight.html">APES: birth weight data example</a>
    </li>
    <li>
      <a href="../articles/diabetes.html">APES: diabetes data example</a>
    </li>
    <li>
      <a href="../articles/speed.html">Speeding up APES</a>
    </li>
    <li>
      <a href="../articles/install_bestsubset.html">Install `bestsubset`</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kevinwang09/APES/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>APES: birth weight data example</h1>
                        <h4 data-toc-skip class="author">Kevin Y.X.
Wang</h4>
            <address class="author_afil">
      School of Mathematics and Statistics, The University of Sydney,
Australia<br><h4 data-toc-skip class="author">Garth
Tarr</h4>
            <address class="author_afil">
      School of Mathematics and Statistics, The University of Sydney,
Australia<br><h4 data-toc-skip class="author">Jean
Y.H. Yang</h4>
            <address class="author_afil">
      School of Mathematics and Statistics, The University of Sydney,
Australia<br><h4 data-toc-skip class="author">Samuel
Mueller</h4>
            <address class="author_afil">
      Department of Mathematics and Statistics, Macquarie University,
Australia<br><small class="dont-index">Source: <a href="https://github.com/kevinwang09/APES/blob/HEAD/vignettes/articles/birthweight.Rmd" class="external-link"><code>vignettes/articles/birthweight.Rmd</code></a></small>
      <div class="hidden name"><code>birthweight.Rmd</code></div>

    </address>
</address>
</address>
</address>
</div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we will demonstrate a real application of APES on a
logistic regression model. The data we have chosen is the birth weight
(<code>birthwt</code>) data from the <code>MASS</code> package. In this
data, there are 189 observations and the binary response variable is
whether an infant is in the low-weight group (<code>low</code>). There
are eight predictor variables in total comprising of two numeric
variables (<code>age</code> and <code>lwt</code>) and six others are
factor variables.</p>
</div>
<div class="section level2">
<h2 id="loading-packages-and-setting-up-the-data">Loading packages and setting up the data<a class="anchor" aria-label="anchor" href="#loading-packages-and-setting-up-the-data"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kevinwang09/APES" class="external-link">APES</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.4</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.0</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.4.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.0</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">## ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">select()</span> masks <span style="color: #0000BB;">MASS</span>::select()</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"birthwt"</span>, package <span class="op">=</span> <span class="st">"MASS"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="fl">14</span><span class="op">)</span> <span class="op">+</span></span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We will simplify the data using the code below.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">birthwt</span>, <span class="op">{</span></span>
<span>  <span class="va">race</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">race</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"other"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ptd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ptl</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">ftv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ftv</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">ftv</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"2+"</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>low <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">low</span><span class="op">)</span>, <span class="co">## indicator for low-weight group</span></span>
<span>             <span class="va">age</span>, <span class="co">## mother's age in years</span></span>
<span>             <span class="va">lwt</span>, <span class="co">## mother's weight in pounds at last menstrual period</span></span>
<span>             <span class="va">race</span>, <span class="co">## mother's race (white, black, other)</span></span>
<span>             smoke <span class="op">=</span> <span class="op">(</span><span class="va">smoke</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="co">## smoking status during pregnancy</span></span>
<span>             <span class="va">ptd</span>, <span class="co">## indicator for previous premature labours</span></span>
<span>             ht <span class="op">=</span> <span class="op">(</span><span class="va">ht</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="co">## indicator for history of hypertension</span></span>
<span>             ui <span class="op">=</span> <span class="op">(</span><span class="va">ui</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="co">## indicator for uterine irritability</span></span>
<span>             <span class="va">ftv</span> <span class="co">## number of physician visits during the first trimester</span></span>
<span>             <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">bwt</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 189</span></span>
<span><span class="co">## Columns: 9</span></span>
<span><span class="co">## $ low   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span></span>
<span><span class="co">## $ age   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 19, 33, 20, 21, 18, 21, 22, 17, 29, 26, 19, 19, 22, 30, 18, 18, …</span></span>
<span><span class="co">## $ lwt   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 182, 155, 105, 108, 107, 124, 118, 103, 123, 113, 95, 150, 95, 1…</span></span>
<span><span class="co">## $ race  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> black, other, white, white, white, other, white, other, white, w…</span></span>
<span><span class="co">## $ smoke <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, TRUE, TRUE,…</span></span>
<span><span class="co">## $ ptd   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…</span></span>
<span><span class="co">## $ ht    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…</span></span>
<span><span class="co">## $ ui    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> TRUE, FALSE, FALSE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALS…</span></span>
<span><span class="co">## $ ftv   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> 0, 2+, 1, 2+, 0, 0, 1, 1, 1, 0, 0, 1, 0, 2+, 0, 0, 0, 2+, 0, 1, …</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="single-run-of-apes-on-birthweight-data">Single run of APES on birthweight data<a class="anchor" aria-label="anchor" href="#single-run-of-apes-on-birthweight-data"></a>
</h2>
<p>We will first fit a “full” logistic regression model utilising all
available variables to get a preliminary understanding of the data and
the model.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">full_model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">low</span> <span class="op">~</span> <span class="va">.</span>, family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">bwt</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">full_model</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)    0.823      1.245   0.661    0.508</span></span>
<span><span class="co">## age           -0.037      0.039  -0.962    0.336</span></span>
<span><span class="co">## lwt           -0.016      0.007  -2.211    0.027</span></span>
<span><span class="co">## raceblack      1.192      0.536   2.225    0.026</span></span>
<span><span class="co">## raceother      0.741      0.462   1.604    0.109</span></span>
<span><span class="co">## smokeTRUE      0.756      0.425   1.778    0.075</span></span>
<span><span class="co">## ptdTRUE        1.344      0.481   2.796    0.005</span></span>
<span><span class="co">## htTRUE         1.913      0.721   2.654    0.008</span></span>
<span><span class="co">## uiTRUE         0.680      0.464   1.465    0.143</span></span>
<span><span class="co">## ftv1          -0.436      0.479  -0.910    0.363</span></span>
<span><span class="co">## ftv2+          0.179      0.456   0.392    0.695</span></span></code></pre>
<p>While on the outset, many of these variables would have seem to have
an impact on the birth weight of an infant, the summary of the logistic
model (in particular the p-values) imply that some variables are
redundant. So we may wish to perform variable selection on this data
using the <code>APES</code> package with the main function being
<code>apes</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">apes_result</span> <span class="op">=</span> <span class="fu"><a href="../reference/APES.html">apes</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">full_model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## No variable size specified, searching all sizes from 1 to p...</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">apes_result</span></span></code></pre></div>
<pre><code><span><span class="co">## Time taken:  5.522569e-05  minutes </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  APES - AIC selected the following variables </span></span>
<span><span class="co">## intercept       age       lwt raceblack raceother smokeTRUE   ptdTRUE    htTRUE </span></span>
<span><span class="co">##     0.095     0.000    -0.017     1.264     0.864     0.876     1.231     1.767 </span></span>
<span><span class="co">##    uiTRUE      ftv1     ftv2+ </span></span>
<span><span class="co">##     0.000     0.000     0.000 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  APES - BIC selected the following variables </span></span>
<span><span class="co">## intercept       age       lwt raceblack raceother smokeTRUE   ptdTRUE    htTRUE </span></span>
<span><span class="co">##    -1.057     0.000     0.000     0.000     0.000     0.000     1.463     0.000 </span></span>
<span><span class="co">##    uiTRUE      ftv1     ftv2+ </span></span>
<span><span class="co">##     0.000     0.000     0.000</span></span></code></pre>
<p>The <code>apes_result</code> gives us an indiaction as to which
variables are considered to be the most important by the Akaike
Information Criterion (AIC) and the Bayesian Information Criterion (BIC)
under an approximated exhaustive search. Note that APES handles a factor
variable in similar style as other <code>R</code> packages by
(alphabetically) selecting a level in the factor as the reference level
and compare all other levels against this reference.</p>
</div>
<div class="section level2">
<h2 id="variable-selection-stability">Variable selection stability<a class="anchor" aria-label="anchor" href="#variable-selection-stability"></a>
</h2>
<p>Suppose we are using the BIC as the main selection criterion, a
single application of APES suggests that we should only select the
<code>ptd</code> variable. However, <a href="http://garthtarr.github.io/mplot/articles/birthweight.html" class="external-link">previous
studies into this data</a> suggested that this data possess several
interesting characteristics, one being variable selection instability.
This means that the variables we select based on a single application of
any model selection method cannot always be reproduced if the data is
slightly perturbed. One way we can confirm the existence of this
instability is to perform a bootstrap resampling of the observations,
this introduces a perturbation on the data which affects model
selection.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">)</span></span>
<span><span class="va">boot_bwt</span> <span class="op">=</span> <span class="va">bwt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bwt</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">bwt</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">full_model2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">low</span> <span class="op">~</span> <span class="va">.</span>, family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">boot_bwt</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">full_model2</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)    0.382      1.194   0.320    0.749</span></span>
<span><span class="co">## age           -0.001      0.039  -0.038    0.970</span></span>
<span><span class="co">## lwt           -0.017      0.007  -2.518    0.012</span></span>
<span><span class="co">## raceblack      1.238      0.515   2.404    0.016</span></span>
<span><span class="co">## raceother      0.346      0.487   0.711    0.477</span></span>
<span><span class="co">## smokeTRUE      0.824      0.433   1.901    0.057</span></span>
<span><span class="co">## ptdTRUE        1.097      0.486   2.257    0.024</span></span>
<span><span class="co">## htTRUE         1.602      0.832   1.926    0.054</span></span>
<span><span class="co">## uiTRUE         0.819      0.483   1.695    0.090</span></span>
<span><span class="co">## ftv1          -0.970      0.553  -1.754    0.079</span></span>
<span><span class="co">## ftv2+         -0.194      0.458  -0.423    0.672</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/APES.html">apes</a></span><span class="op">(</span><span class="va">full_model2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## No variable size specified, searching all sizes from 1 to p...</span></span></code></pre>
<pre><code><span><span class="co">## Time taken:  4.70082e-06  minutes </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  APES - AIC selected the following variables </span></span>
<span><span class="co">## intercept       age       lwt raceblack raceother smokeTRUE   ptdTRUE    htTRUE </span></span>
<span><span class="co">##     0.614     0.000    -0.018     1.111     0.000     0.681     1.161     1.675 </span></span>
<span><span class="co">##    uiTRUE      ftv1     ftv2+ </span></span>
<span><span class="co">##     0.812    -0.996     0.000 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  APES - BIC selected the following variables </span></span>
<span><span class="co">## intercept       age       lwt raceblack raceother smokeTRUE   ptdTRUE    htTRUE </span></span>
<span><span class="co">##     0.897     0.000    -0.016     1.054     0.000     0.000     1.423     0.000 </span></span>
<span><span class="co">##    uiTRUE      ftv1     ftv2+ </span></span>
<span><span class="co">##     0.000    -1.315     0.000</span></span></code></pre>
<p>We can see that when we perturb on the data, the p-value for the
<code>ht</code> variable increases from 0.008 to 0.054, which could
cause confusion if we take a naive approach to only select variables
with p-values &lt; 0.05. Similarly, this perturbation also affects APES,
as we have now selected three extra variables under the BIC. Variable
selection stability is not a criticism of any specific methods, but
rather, it is an issue for data with ambiguous signals. We will describe
how the <code>APES</code> package uses bootstrap resampling to improve
variable selection stability in the next section.</p>
</div>
<div class="section level2">
<h2 id="bootstrapping-with-the-apes-package">Bootstrapping with the <code>APES</code> package<a class="anchor" aria-label="anchor" href="#bootstrapping-with-the-apes-package"></a>
</h2>
<p>One way that we can improve variable selection stability is to apply
<code>APES</code> on many bootstrap resampling of the data and then
average the computed results. As the main motivation of APES is to make
exhaustive selection fast and it is therefore also ideally suited for
such a procedure which requires a large amount of computation.</p>
<p>Running the <code>apes</code> function with an extra argument
<code>n_boot</code> automatically invokes bootstrapping sampling on the
rows of the data. The returned object is a <code>boot_apes</code> class
object which stores all bootstrapped <code>apes</code> objects. This
class comes with generic <code>print</code>, <code>summary</code> and
<code>plot</code> methods, which make the interaction with such an
object much easier.</p>
<p>The <code>summary</code> method summarises the averaged selection
(empirical) probability of each variable for a given information
criterion. In the next section, we will explore the <code>plot</code>
generic methods for this object class.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boot_result</span> <span class="op">=</span> <span class="fu"><a href="../reference/APES.html">apes</a></span><span class="op">(</span><span class="va">full_model</span>, n_boot <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## No variable size specified, searching all sizes from 1 to p...</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">boot_result</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">boot_result</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">boot_result</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">boot_result</span>, ic <span class="op">=</span> <span class="st">"BIC"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">boot_result</span>, ic <span class="op">=</span> <span class="st">"AIC"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="variable-importance-plot">Variable importance plot<a class="anchor" aria-label="anchor" href="#variable-importance-plot"></a>
</h2>
<p>The variable importance plot is a technique explored in Murray et.
al. (2013) and it shows the stability of each variable as empirical
probability of selection against different penalty terms, assuming the a
general information criterion formulation $-2 + (p + 1) $, where <span class="math inline">\(\ell\)</span> is the log-likelihood of a model,
<code>\lambda</code> is the penalty term and <span class="math inline">\(p\)</span> is the number of predictors (excluding
the intercept term). The most important difference between this
<code>plot</code> method and the
<code>summary</code>/<code>method</code> methods is that we are no
longer fixated on a single information criterion such as the AIC (where
<span class="math inline">\(\lambda = 2\)</span>) and the BIC (where
<span class="math inline">\(\lambda = \log(p)\)</span>). Instead, we can
visualise the selection with ever increasing penalty term <span class="math inline">\(\lambda\)</span>. Variables with stronger
selection stability are those with high probabilities of selection with
increasingly higher levels of penalisation.</p>
<p>We can see that the variables in order of strength of stability are
<code>ptd</code>, <code>ht</code> and <code>lwt</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">boot_result</span>, type <span class="op">=</span> <span class="st">"vip"</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthweight_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="section level3">
<h3 id="tile-version-of-vip-plot">Tile version of VIP plot<a class="anchor" aria-label="anchor" href="#tile-version-of-vip-plot"></a>
</h3>
<p>This plot is identical in construction as the VIP plot above.
However, the probability of selection is used as colours in a tile plot.
The most stably selected variables are on the top of the y-axis.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">boot_result</span>, type <span class="op">=</span> <span class="st">"vip_tile"</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthweight_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="model-averaged-coefficient-plot">Model averaged coefficient plot<a class="anchor" aria-label="anchor" href="#model-averaged-coefficient-plot"></a>
</h3>
<p>APES stores all the coefficient estimates in each bootstrap run. We
can use this information to compute cumulative averages of variable
coefficients. This plot allows us to examine the stability of the model
coefficient estimates whereas the previous VIP plots shows only the
stability of variable selection.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">boot_result</span>, type <span class="op">=</span> <span class="st">"ma"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 1 rows containing missing values (`geom_text_repel()`).</span></span></code></pre>
<p><img src="birthweight_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="information-criterion-pathway-plot">Information criterion pathway plot<a class="anchor" aria-label="anchor" href="#information-criterion-pathway-plot"></a>
</h3>
<p>During the bootstrap computations, APES records the best AIC/BIC
models across all bootstrap runs. Due to the induced perturbation, the
AIC/BIC-best model in each bootstrapped data do not always coincide. One
way to examine the differences between these models is to look into the
model size of the best selected model.</p>
<p>Here, each bootstrap run is represented by a black curve with the
BIC-selected model of each run coloured as red. We can see that it is
rare for a model of size 2 to be selected when using the BIC, with the
majority of the models being between 3 and 6 in model size. This is a
reason why we should perform such a bootstrap procedure to examine the
model selection stability as a single run of APES only identifies a
model of size two under the BIC selection criterion.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">boot_result</span>, type <span class="op">=</span> <span class="st">"path"</span>, order <span class="op">=</span> <span class="st">"BIC"</span><span class="op">)</span></span></code></pre></div>
<p><img src="birthweight_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="parallel-processing">Parallel processing<a class="anchor" aria-label="anchor" href="#parallel-processing"></a>
</h2>
<p>For large number of bootstrap runs, one might consider using parallel
processing to reduce the total computational time. The parallel backend
support of <code>APES</code> uses the <code>furrr</code> package. To
invoke parallel processing, this requires a single parameter
<code>workers</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parallel_result</span> <span class="op">=</span> <span class="fu"><a href="../reference/APES.html">apes</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">full_model</span>, n_boot <span class="op">=</span> <span class="fl">100</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">parallel_result</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
<ul>
<li><p>Mueller, S. and Welsh, A. H. (2010), On model selection curves.
International Statistical Review, 78:240-256. doi:
10.1111/j.1751-5823.2010.00108.x</p></li>
<li><p>Murray, K., Heritier, S. and Mueller, S. (2013), Graphical tools
for model selection in generalized linear models. Statistics in
Medicine, 32:4438-4451. doi: 10.1002/sim.5855</p></li>
<li><p>Tarr G, Mueller S and Welsh AH (2018). mplot: An R Package for
Graphical Model Stability and Variable Selection Procedures. Journal of
Statistical Software, 83(9), pp. 1-28. doi:
10.18637/jss.v083.i09</p></li>
<li><p>Wang, K. Y., Tarr, G., Yang, J. Y., &amp; Mueller, S. (2019).
Fast and approximate exhaustive variable selection for generalised
linear models with APES. Australian &amp; New Zealand Journal of
Statistics, 61(4), 445–465. <a href="https://doi.org/10.1111/anzs.12276" class="external-link uri">https://doi.org/10.1111/anzs.12276</a></p></li>
</ul>
</div>
<div class="section level2">
<h2 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.2 (2023-10-31)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] lubridate_1.9.3 forcats_1.0.0   stringr_1.5.0   dplyr_1.1.3    </span></span>
<span><span class="co">##  [5] purrr_1.0.2     readr_2.1.4     tidyr_1.3.0     tibble_3.2.1   </span></span>
<span><span class="co">##  [9] ggplot2_3.4.4   tidyverse_2.0.0 MASS_7.3-60     APES_1.0.0     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] gtable_0.3.4       xfun_0.41          bslib_0.5.1        ggrepel_0.9.4     </span></span>
<span><span class="co">##  [5] lattice_0.21-9     tzdb_0.4.0         vctrs_0.6.4        tools_4.3.2       </span></span>
<span><span class="co">##  [9] generics_0.1.3     parallel_4.3.2     fansi_1.0.5        highr_0.10        </span></span>
<span><span class="co">## [13] pkgconfig_2.0.3    Matrix_1.6-1.1     RColorBrewer_1.1-3 desc_1.4.2        </span></span>
<span><span class="co">## [17] lifecycle_1.0.3    farver_2.1.1       compiler_4.3.2     textshaping_0.3.7 </span></span>
<span><span class="co">## [21] munsell_0.5.0      leaps_3.1          codetools_0.2-19   htmltools_0.5.6.1 </span></span>
<span><span class="co">## [25] sass_0.4.7         yaml_2.3.7         pillar_1.9.0       pkgdown_2.0.7     </span></span>
<span><span class="co">## [29] furrr_0.3.1        jquerylib_0.1.4    cachem_1.0.8       parallelly_1.36.0 </span></span>
<span><span class="co">## [33] gtools_3.9.4       tidyselect_1.2.0   digest_0.6.33      stringi_1.7.12    </span></span>
<span><span class="co">## [37] future_1.33.0      reshape2_1.4.4     listenv_0.9.0      labeling_0.4.3    </span></span>
<span><span class="co">## [41] splines_4.3.2      rprojroot_2.0.3    fastmap_1.1.1      grid_4.3.2        </span></span>
<span><span class="co">## [45] colorspace_2.1-0   cli_3.6.1          magrittr_2.0.3     survival_3.5-7    </span></span>
<span><span class="co">## [49] utf8_1.2.4         withr_2.5.2        scales_1.2.1       timechange_0.2.0  </span></span>
<span><span class="co">## [53] rmarkdown_2.25     globals_0.16.2     ragg_1.2.6         hms_1.1.3         </span></span>
<span><span class="co">## [57] memoise_2.0.1      evaluate_0.23      knitr_1.45         rlang_1.1.1       </span></span>
<span><span class="co">## [61] Rcpp_1.0.11        glue_1.6.2         jsonlite_1.8.7     plyr_1.8.9        </span></span>
<span><span class="co">## [65] R6_2.5.1           systemfonts_1.0.5  fs_1.6.3</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Kevin Wang, Garth Tarr, Jean Yang, Samuel Mueller.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
